---
layout: center-content
---

# レイヤーは画像

**レイヤーの合成処理は軽いが、レイヤーの存在自体は重い**

- 少なくとも1ピクセルごとに、赤、緑、青、透明度の4つの情報を保持する
- レイヤーが増えるほど、その枚数分メモリを使う
- レイヤーに書き出された範囲が大きい（＝画像サイズが大きい）と、<br />GPUに送信する処理も重くなる

iOS ChromeはむしろGPU処理で不安定になることもあった
（[2023年1月に修正](https://bugs.webkit.org/show_bug.cgi?id=228333)）


<!--
レイヤーの合成だけで済ませることで、処理は確かに軽くなりますが、レイヤーの存在自体は非常に重く、メモリを大量に消費するものです。

レイヤーを構成する1ピクセルごとに、少なくとも色を表す赤、緑、青、透明度の4バイトの情報を格納する必要があり、それを縦横のピクセル分、メモリを確保しなければなりません。

アニメーションがかくつくときには、わざと3Dの指定を入れたり、will-changeプロパティを指定することで、レイヤーを無理やり生成させる手法も使われていますが、スマートフォンではむしろ負荷が大きくなるリスクがあります。

iOSのChromeでは、GPU処理を伴うtransform、opacityなどをtransitionさせたときに、フレームレートが落ちて瞬時にアニメーション終了後の表示になってしまうバグに遭遇することもあります。

とはいえ、このバグも解決の未来は近そうです。
-->
